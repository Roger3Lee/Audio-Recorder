# AudioRecorder 完整项目需求文档

## 📋 项目概述

AudioRecorder是一个专业的桌面音频录制控制器应用程序，基于C# .NET 8.0和WPF开发，支持多种控制方式，包括桌面GUI、WebSocket远程控制、URL协议调用等，为音频录制提供了完整的解决方案。

## 🎯 核心功能模块

### 1. 音频录制核心
- **实时音频监控**: 系统音频 + 麦克风分离录制
- **专业音频处理**: 降噪、AGC、压缩算法
- **多格式支持**: WAV、MP3等格式输出
- **自动文件管理**: 桌面AudioRecordings文件夹存储

### 2. 桌面用户界面
- **双模态设计**: 紧凑模式(200×50px) + 完整模式(200×200px)
- **状态管理**: 未开始 → 录音中 → 已暂停 → 录音中
- **图标系统**: SVG矢量图标，支持动态状态切换
- **拖拽支持**: 可拖动窗口位置，置顶显示

### 3. WebSocket远程控制
- **端口**: 8080端口WebSocket服务器
- **远程操作**: 开始/停止/暂停录音
- **状态查询**: 实时录音状态反馈
- **多客户端**: 支持多个远程客户端同时连接

### 4. URL协议支持
- **自定义协议**: `audiorecorder://` 启动支持
- **参数传递**: action、volume、quality等参数
- **自动注册**: 安装时自动注册系统协议
- **浏览器集成**: 支持从网页直接启动应用

## 🎨 界面设计规格

### 模态一 (200×50px) - 紧凑模式
```
[状态标签75px] [录音35×35] [停止35×35] [分隔线] [展开35×35]
```
- **状态标签**: 最左边位置，字体14px，左对齐
- **录音按钮**: 绿色播放▶(未开始/已暂停) / 橙色暂停⏸(录音中)
- **停止按钮**: 黑色方形⏹，点击回到未开始状态
- **分隔线**: 1px宽度，视觉分隔
- **展开按钮**: 黑色对角箭头，切换到模态二

### 模态二 (200×200px) - 完整模式
```
右上角: [最小化35×35] [关闭35×35] (紧凑布局)
中央: [状态标签]
底部: [录音60×60] [停止60×60] (底部对齐)
```
- **标题栏按钮**: 35×35px，图标25×25px
- **状态标签**: 中央显示，字体14px
- **录音控制**: 60×60px大按钮，底部对齐

### 图标规格
- **模态一按钮**: 35×35px，图标25×25px
- **模态二主按钮**: 60×60px，图标35×40px
- **标题栏按钮**: 35×35px，图标25×25px
- **颜色方案**: 绿色(#27AE60)、橙色(#F39C12)、黑色(#000000)

## 🔐 停止录音确认功能

### 功能描述
当用户点击停止录音按钮时，系统显示确认覆盖层，询问"确定停止录音？"

### 工作流程
1. **用户点击停止**: 检查录音状态
2. **状态判断**: 录音中显示确认，已暂停直接停止
3. **自动切换**: 显示模态二并显示确认覆盖层
4. **用户选择**: 确认停止或取消操作
5. **状态保护**: 确认期间禁用其他按钮

### 界面设计
- **覆盖层**: 半透明黑色背景，白色圆角容器
- **提示文字**: "确定停止录音？" (14px, 微软雅黑)
- **操作按钮**: 红色"确认" + 灰色"取消" (60×30px)

## 🌐 浏览器登录授权功能 (待实现)

### 功能概述
实现OAuth 2.0授权流程，用户通过浏览器登录第三方服务，获取授权后自动完成身份验证。

### 授权流程
1. **启动本地服务器**: 随机端口HTTP监听器
2. **构建授权URL**: 包含client_id、redirect_uri、scope等参数
3. **打开浏览器**: 系统默认浏览器打开授权页面
4. **用户操作**: 完成登录和授权
5. **接收回调**: 本地服务器接收授权码
6. **交换令牌**: 使用授权码换取访问令牌
7. **关闭服务器**: 完成授权后关闭本地HTTP服务

### 支持的授权提供商
- **Google OAuth 2.0**: openid email profile
- **GitHub OAuth 2.0**: user repo
- **Microsoft OAuth 2.0**: openid profile email

### 授权有效性保持
- **自动令牌刷新**: 过期前5分钟自动刷新
- **程序启动恢复**: 重启后自动恢复有效登录状态
- **网络中断恢复**: 网络恢复后自动重试令牌刷新
- **安全存储**: Windows凭据管理器存储令牌

## 🔧 技术架构

### 开发环境
- **框架**: .NET 8.0 Windows
- **UI框架**: WPF (Windows Presentation Foundation)
- **音频处理**: NAudio库
- **序列化**: Newtonsoft.Json
- **日志**: Microsoft.Extensions.Logging

### 项目结构
```
AudioRecorder/
├── 核心组件
│   ├── SimpleAudioRecorder.cs - 音频录制引擎
│   ├── RecorderWindow.xaml - WPF主界面
│   ├── RecorderWindow.xaml.cs - 界面逻辑
│   ├── SimpleWebSocketServer.cs - WebSocket服务器
│   └── UrlProtocolHandler.cs - URL协议处理器
├── 服务组件
│   ├── AudioFileUploadService.cs - 文件上传服务
│   ├── ConfigurationService.cs - 配置管理
│   └── ConsoleLogger.cs - 日志服务
├── 工具组件
│   ├── SvgIconConverter.cs - SVG图标转换器
│   └── 各种SVG图标文件
└── 配置文件
    ├── appsettings.json - 应用配置
    └── 各种README文档
```

### 依赖包
- **NAudio**: 音频处理库
- **Newtonsoft.Json**: JSON序列化
- **Microsoft.Extensions.Logging**: 日志框架

## 📱 用户体验特性

### 界面特性
- **无边框设计**: 圆角透明窗口
- **置顶显示**: 始终在其他窗口之上
- **响应式**: 模态间流畅切换
- **专业外观**: 现代扁平化设计

### 交互特性
- **智能状态管理**: 录音状态自动同步
- **防误操作**: 停止录音确认机制
- **快捷操作**: 一键开始/暂停/停止
- **远程控制**: WebSocket远程操作支持

### 状态指示
- **实时状态**: 未开始、录音中、已暂停
- **视觉反馈**: 图标颜色和状态文字同步
- **进度提示**: 录音时长和文件大小显示

## 🚀 部署和安装

### 构建要求
- **.NET 8.0 SDK**: 开发环境
- **WiX Toolset v4**: 安装包构建
- **Windows x64**: 目标平台

### 安装包特性
- **MSI格式**: 标准Windows安装包
- **自动协议注册**: 安装时注册URL协议
- **开始菜单集成**: 创建快捷方式
- **桌面快捷方式**: 方便用户访问

### 发布选项
- **自包含**: 包含.NET运行时
- **单文件**: 单个可执行文件
- **ReadyToRun**: 预编译优化
- **x64平台**: 64位Windows支持

## 📊 功能完成状态

### ✅ 已完成功能
- [x] 音频录制核心引擎
- [x] WPF双模态界面
- [x] SVG图标系统
- [x] WebSocket远程控制
- [x] URL协议支持
- [x] 停止录音确认功能
- [x] 文件上传服务
- [x] 配置管理服务

### 🔄 进行中功能
- [ ] 浏览器登录授权系统
- [ ] 令牌有效性保持
- [ ] 多账户支持

### 📋 待实现功能
- [ ] 高级音频处理算法
- [ ] 录音文件云同步
- [ ] 用户偏好设置
- [ ] 多语言支持
- [ ] 主题切换
- [ ] 插件系统

## 🧪 测试和验证

### 功能测试
1. **基本录音**: 开始/暂停/停止/恢复
2. **模态切换**: 展开/最小化功能
3. **远程控制**: WebSocket命令执行
4. **协议启动**: URL协议调用
5. **文件上传**: 自动上传录音文件

### 兼容性测试
- **Windows版本**: Windows 10/11
- **音频设备**: 系统音频、麦克风
- **网络环境**: 局域网、互联网
- **浏览器**: Chrome、Edge、Firefox

### 性能测试
- **内存使用**: 长时间运行内存占用
- **CPU使用**: 录音时CPU占用率
- **网络性能**: WebSocket连接稳定性
- **文件I/O**: 录音文件写入性能

## 🔍 故障排除

### 常见问题
1. **应用无法启动**: 检查.NET 8.0 Runtime
2. **无法录制音频**: 检查音频设备权限
3. **WebSocket连接失败**: 检查8080端口占用
4. **协议启动失败**: 检查协议注册状态

### 日志系统
- **控制台输出**: 实时状态和错误信息
- **文件日志**: 持久化日志记录
- **错误追踪**: 详细异常信息记录
- **性能监控**: 关键操作耗时统计

## 📈 未来发展规划

### 短期目标 (1-2个月)
- 完成浏览器登录授权功能
- 实现令牌有效性保持
- 优化用户界面体验
- 完善错误处理机制

### 中期目标 (3-6个月)
- 添加高级音频处理功能
- 实现云存储集成
- 支持多账户管理
- 开发移动端配套应用

### 长期目标 (6-12个月)
- 构建完整的音频处理平台
- 支持插件和扩展开发
- 跨平台版本开发
- 企业级功能集成

## 📚 文档和资源

### 技术文档
- **开发指南**: 代码结构和开发规范
- **API文档**: 各组件接口说明
- **部署指南**: 安装和配置说明
- **用户手册**: 功能使用说明

### 设计资源
- **UI设计稿**: 界面布局和交互设计
- **图标资源**: SVG格式图标文件
- **配色方案**: 统一的视觉设计规范
- **字体规范**: 界面文字样式定义

## 🎉 项目总结

AudioRecorder项目已经实现了核心的音频录制功能，包括专业的桌面界面、远程控制能力、URL协议支持等。项目采用现代化的技术栈，具有良好的可扩展性和维护性。

### 技术亮点
- **现代化架构**: .NET 8.0 + WPF技术栈
- **专业音频**: NAudio库提供高质量音频处理
- **灵活控制**: 多种控制方式满足不同场景需求
- **用户友好**: 直观的界面设计和流畅的交互体验

### 应用价值
- **专业录音**: 满足会议、教学、播客等专业录音需求
- **远程控制**: 支持远程操作，适合多场景使用
- **系统集成**: 与Windows系统深度集成
- **扩展性强**: 模块化设计支持功能扩展

### 发展前景
项目具有良好的发展前景，可以进一步发展为：
- 专业的音频处理平台
- 企业级会议录制解决方案
- 教育行业音频内容制作工具
- 播客和内容创作者的专业工具

---

**文档版本**: 1.0  
**最后更新**: 2024年12月  
**维护人员**: AudioRecorder开发团队
