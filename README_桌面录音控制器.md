# 桌面录音控制器 - 使用说明

## 功能概述

这是一个专业的桌面录音控制器，具有以下特点：

- **桌面置顶窗口**：小窗口始终置顶，不影响其他程序使用
- **实时音频监控**：显示系统音频和麦克风的实时电平
- **一键录音控制**：简单的开始/停止录音按钮
- **WebSocket远程控制**：支持通过WebSocket进行远程控制
- **专业音频处理**：内置降噪、AGC、压缩等音频处理功能

## 运行要求

- Windows 10/11
- .NET 8.0 Runtime
- 管理员权限（用于访问系统音频）

## 使用方法

### 1. 启动应用

#### 方式一：使用启动脚本
双击 `start_recorder.bat` 文件启动应用

#### 方式二：命令行启动
```bash
dotnet run
```

### 2. 界面说明

应用启动后会显示一个简洁的置顶窗口，包含：

- **录音按钮**：点击开始/停止录音，录音时按钮变为红色
- **系统音量横条**：实时显示系统音频电平
- **输入音量横条**：实时显示麦克风音频电平
- **窗口控制**：双击窗口可关闭应用

### 3. WebSocket远程控制

应用会在8080端口启动WebSocket服务器，支持以下命令：

#### 连接地址
```
ws://localhost:8080/ws
```

#### 支持的命令

1. **开始录音**
```json
{
  "Command": "start_recording"
}
```

2. **停止录音**
```json
{
  "Command": "stop_recording"
}
```

3. **获取状态**
```json
{
  "Command": "get_status"
}
```

#### 测试页面
浏览器打开 `http://localhost:8080` 或直接打开 `websocket_test.html` 文件进行测试

### 4. 录音文件

录音文件会保存在桌面的 `AudioRecordings` 文件夹中，包含：
- 系统音频文件
- 麦克风音频文件
- 时间戳命名，便于管理

### 5. 高级功能

#### 音频处理
- **智能降噪**：自动识别并减少背景噪音
- **自动增益控制**：保持音频电平稳定
- **动态压缩**：防止音频过载
- **频谱减法降噪**：专业级噪音抑制

#### 系统集成
- **系统音量监控**：实时监控系统音量变化
- **麦克风增益控制**：自动调节麦克风增益
- **多级音频处理**：确保录音质量

## 故障排除

### 常见问题

1. **应用无法启动**
   - 确保已安装 .NET 8.0 Runtime
   - 以管理员权限运行
   - 检查防火墙设置

2. **无法录制系统音频**
   - 确保系统音频设备正常工作
   - 检查音频驱动程序
   - 确认系统音频权限

3. **WebSocket连接失败**
   - 检查8080端口是否被其他程序占用
   - 确认防火墙允许该端口
   - 尝试重启应用

4. **录音文件找不到**
   - 检查桌面 `AudioRecordings` 文件夹
   - 确认有足够的磁盘空间
   - 检查文件权限

### 日志查看

应用运行时会在控制台输出详细日志，包括：
- 音频设备状态
- WebSocket连接信息
- 录音操作记录
- 错误诊断信息

## 开发说明

### 项目结构

- `DesktopRecorderWindow.cs` - 主窗口界面
- `SimpleAudioRecorder.cs` - 音频录制核心
- `SimpleWebSocketServer.cs` - WebSocket服务器
- `AudioProcessing.cs` - 音频处理算法
- `Program.cs` - 应用程序入口

### 依赖包

- NAudio - 音频处理库
- Newtonsoft.Json - JSON序列化

### 编译

```bash
dotnet build
```

### 发布

```bash
dotnet publish -c Release -r win-x64 --self-contained
```

## 版本信息

- 版本：1.0.0
- 支持平台：Windows x64
- 开发环境：.NET 8.0

## 许可证

本项目遵循MIT许可证。