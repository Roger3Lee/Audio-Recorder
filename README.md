# NAudio 音频录制器 - 支持混合/分离模式

基于NAudio库开发的Windows音频录制客户端程序，支持**混合模式**和**分离模式**两种录制方式，满足不同场景的音频录制需求。

## 功能特性

### 录制模式
- **混合模式**: 将系统音频和麦克风音频实时混合到单个立体声文件
- **分离模式**: 系统音频和麦克风音频分别保存为独立的WAV文件

### 基础功能
- **系统音频录制**: 录制电脑正在播放的所有声音（立体声混音）
- **麦克风录制**: 录制麦克风输入的声音
- **智能音频平衡**: 在混合模式下自动调整系统音频和麦克风音量比例
- **设备选择**: 支持选择不同的麦克风设备
- **实时状态**: 显示录制状态和保存路径
- **自动命名**: 录制文件按时间戳自动命名

## 录制模式详解

### 混合模式
- **输出格式**: 44.1kHz, 16-bit, 立体声WAV文件
- **智能增益**: 系统音频70%音量，麦克风80%音量，防止音频过载
- **防剪切保护**: 自动限制音频峰值，避免失真
- **立体声分配**: 麦克风音频分配到左右声道，保持立体声效果
- **适用场景**: 在线教学、游戏解说、会议记录等需要合并音频的场景

### 分离模式
- **系统音频**: 保持原始格式（通常为44.1kHz, 16-bit, 立体声）
- **麦克风音频**: 44.1kHz, 16-bit, 单声道
- **独立文件**: 两个音频源保存为完全独立的文件
- **后期处理**: 便于在音频编辑软件中进行独立处理和调节
- **适用场景**: 专业音频制作、播客录制、需要独立处理音频轨道的场景

## 系统要求

- Windows 10/11
- .NET 8.0 Runtime
- 支持WASAPI的音频设备

## 使用方法

1. **启动程序**: 运行AudioRecorder.exe
2. **选择录制源**: 
   - 勾选"录制系统音频"来录制电脑播放的声音
   - 勾选"录制麦克风音频"来录制麦克风输入
3. **选择录制模式**:
   - **混合模式**: 适合需要合并音频的场景，输出单个文件
   - **分离模式**: 适合需要独立处理音轨的专业场景
4. **选择麦克风**: 如果要录制麦克风，从下拉列表中选择合适的设备
5. **开始录制**: 点击对应的录制按钮
6. **停止录制**: 点击"停止录制"按钮

## 输出文件

录制的音频文件保存在桌面的"AudioRecordings"文件夹中：

### 混合模式
- 混合音频: `MixedAudio_YYYYMMDD_HHMMSS.wav`

### 分离模式
- 系统音频: `SystemAudio_YYYYMMDD_HHMMSS.wav`
- 麦克风音频: `Microphone_YYYYMMDD_HHMMSS.wav`

## 编译和运行

### 前提条件
- Visual Studio 2022 或 .NET 8.0 SDK
- Windows 10/11

### 编译步骤
```bash
# 恢复NuGet包
dotnet restore

# 编译项目
dotnet build

# 运行程序
dotnet run
```

### 发布程序
```bash
# 发布为自包含的可执行文件
dotnet publish -c Release -r win-x64 --self-contained
```

## 依赖库

- **NAudio 2.2.1**: 核心音频处理库
- **NAudio.WinMM 2.2.1**: Windows多媒体API支持
- **NAudio.Wasapi 2.2.1**: WASAPI音频录制支持

## 使用场景对比

| 场景 | 推荐模式 | 说明 |
|------|----------|------|
| 在线教学录制 | 混合模式 | 需要同时听到讲师声音和演示内容 |
| 游戏解说视频 | 混合模式 | 游戏音效和解说需要同步合并 |
| 会议记录 | 混合模式 | 便于后续播放和分享 |
| 专业音频制作 | 分离模式 | 需要独立调节各音轨的音量和效果 |
| 播客录制 | 分离模式 | 主持人声音和背景音乐需要分别处理 |
| 音乐制作 | 分离模式 | 人声和伴奏需要独立混音 |

## 故障排除

### 常见问题

1. **无法录制系统音频**
   - 确保Windows音频服务正在运行
   - 检查是否有其他程序占用音频设备
   - 尝试以管理员权限运行程序

2. **找不到麦克风设备**
   - 检查麦克风是否正确连接
   - 在Windows声音设置中确保麦克风已启用
   - 检查麦克风驱动程序是否安装正确

3. **录制文件没有声音**
   - 检查音量设置
   - 确保选择了正确的音频设备
   - 验证系统音频/麦克风是否在其他程序中正常工作

4. **混合模式音频质量问题**
   - 如果混合音频过响，程序会自动防剪切保护
   - 可以调整系统音量和麦克风音量获得最佳效果
   - 确保麦克风距离适中，避免过近造成失真

5. **分离模式文件不同步**
   - 分离模式下的文件可能存在微小的时间差
   - 在音频编辑软件中可以手动对齐时间轴
   - 建议使用音频编辑软件的自动对齐功能

## 技术细节

### 音频混合算法（混合模式）
1. **格式统一**: 将不同格式的音频流转换为统一的44.1kHz立体声格式
2. **实时混合**: 使用浮点数运算进行音频样本混合
3. **增益控制**: 系统音频70%，麦克风80%，防止总音量过载
4. **防剪切**: 自动限制混合结果在[-1.0, 1.0]范围内

### 音频分离处理（分离模式）
1. **原始格式保持**: 系统音频保持其原始采样率和声道配置
2. **直接写入**: 避免格式转换，保持最佳音质
3. **独立处理**: 两个音频流完全独立处理，无相互影响

### 系统音频录制
使用NAudio的`WasapiLoopbackCapture`类来捕获系统音频输出。

### 麦克风录制
使用NAudio的`WaveInEvent`类来录制麦克风输入。

### 线程安全
程序使用锁机制确保音频处理过程的线程安全，UI更新在主线程中执行。

## 开源许可

本项目基于MIT许可证开源。 